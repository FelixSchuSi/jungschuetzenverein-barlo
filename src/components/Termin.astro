---
import { Icon } from 'astro-icon/components';

const dayOfMonthFormatter = new Intl.DateTimeFormat('de-DE', {
	day: 'numeric',
	timeZone: 'Europe/Berlin',
});
const monthFormatter = new Intl.DateTimeFormat('de-DE', {
	month: 'short',
	timeZone: 'Europe/Berlin',
});
const timeFormatter = new Intl.DateTimeFormat('de-DE', {
	timeStyle: 'short',
	timeZone: 'Europe/Berlin',
});

export interface Props {
	termin: TerminProp;
}
export type Termin = {
	type: 'Termin';
	date: Date;
	name: string;
	description: string;
	location: string;
};
export type EinTagMehrereTermine = {
	type: 'EinTagMehrereTermine';
	date: Date;
	termine: Termin[];
};
export type TerminProp = Termin | EinTagMehrereTermine;
const { termin } = Astro.props;

let alleTermine: Termin[] = [];
if (termin.type === 'Termin') {
	alleTermine = [termin];
} else {
	alleTermine = termin.termine;
}
---

<div class="termin-item-root">
	<div class="left">
		<h3 class="day-of-month">{dayOfMonthFormatter.format(termin.date)}</h3>
		<div class="month">{monthFormatter.format(termin.date)}.</div>
	</div>
	<div class="right">
		{
			alleTermine.map((t: Termin) => (
				<>
					<div class="termin-root">
						<div class="time-and-location">
							<div class="time">
								<Icon
									name="ic:baseline-access-time-filled"
									width={24}
									height={24}
								/>
								<div>{timeFormatter.format(t.date)}</div>
							</div>
							<div class="location">
								<Icon name="ic:baseline-location-on" width={24} height={24} />
								<div>{t.location}</div>
							</div>
						</div>
						<h3 class="name" set:html={t.name} />
						<div class="description" set:html={t.description} />
					</div>
					<div class="h-line" />
				</>
			))
		}
	</div>
</div>

<style>
	.termin-item-root {
		display: flex;
		max-width: 100%;
		flex-grow: 1;
	}

	.left {
		background-color: var(--theme-primary);
		color: var(--theme-on-primary);
		padding: 1rem;
		border-top-left-radius: calc(var(--theme-shape-radius) / 2);
		border-bottom-left-radius: calc(var(--theme-shape-radius) / 2);
		min-width: 4rem;
	}

	@media (max-width: 768px) {
		.left {
			min-width: 3rem;
			padding: 0.5rem;
		}
	}

	.day-of-month,
	.month {
		display: flex;
		justify-content: center;
	}

	.day-of-month {
		margin: 0;
	}

	.right {
		background-color: var(--theme-surface-1);
		color: var(--theme-on-surface-1);
		padding: 1rem;
		border-top-right-radius: calc(var(--theme-shape-radius) / 2);
		border-bottom-right-radius: calc(var(--theme-shape-radius) / 2);
		flex-grow: 1;
		display: flex;
		flex-direction: column;
	}

	.h-line {
		width: 100%;
		border-top: 1px solid var(--theme-primary);
		margin-top: 1rem;
		margin-bottom: 1rem;
		opacity: 20%;
	}

	.h-line:last-child {
		display: none;
	}

	.time-and-location {
		display: flex;
		gap: 0.5rem;
	}

	.time,
	.location {
		display: flex;
		align-items: center;
		gap: 0.125rem;
	}

	.location > *:first-child,
	.time > *:first-child {
		flex-shrink: 0;
	}

	.description {
		max-width: 40rem;
	}

	h3 {
		word-break: break-all;
		font-size: xx-large;
		max-width: 40rem;
	}

	.name,
	.description {
		word-break: break-word;
	}
</style>
